Build review:
  stage: Build
  variables:
    IMAGE_PREFIX: "${REVIEW_REGISTRY_HOST}/${CI_PROJECT_PATH}/"
    IMAGE_TAG: $CI_COMMIT_SHORT_SHA
  before_script:
    - docker login -u $REVIEW_REGISTRY_USERNAME -p $REVIEW_REGISTRY_PASSWORD $REVIEW_REGISTRY_HOST
    - export GIT_COMMIT_HASH=$(git rev-parse HEAD)
    - export GIT_TAG_NAME=$(git describe --tags)
  script:
    - echo -n "$REVIEW_REGISTRY_HOST" > ci_build_image_registry.txt
    - echo -n "$IMAGE_TAG" > ci_build_image_tag.txt
    - docker-compose version
    - time docker-compose build --parallel
    - time docker-compose push
  tags:
    - review
    - shell
  only:
    - /^feature\/.*$/
  artifacts:
    paths:
      - ci_build_image_registry.txt
      - ci_build_image_tag.txt
