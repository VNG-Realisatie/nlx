Rebuild demo:
  # Use `Deploy demo` as base, overwriting `before_script` and `rules`, but merging `variables`
  extends: Deploy demo
  before_script:
    - source ./.gitlab/ci/functions.sh
    - |
      for CHART in ${HELM_CHARTS_TO_DEPLOY}; do
        start_section uninstall_${CHART} "Uninstalling chart '${CHART}'"
        CHART_DIRECTORY="./helm/deploy/${CHART}"

        helm uninstall ${CHART} \
          --namespace ${K8S_NAMESPACE}

        stop_section uninstall_${CHART}
      done
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - if: '$CI_COMMIT_BRANCH == "master" && $CI_PROJECT_PATH == "commonground/nlx/nlx"'
      when: manual
      allow_failure: true
