Deploy demo, preprod & prod:
  stage: Deploy
  environment:
    name: demo
  before_script:
    - kubectl config use-context delta.k8s.nlx.io
    - export GIT_COMMIT_HASH=$(git rev-parse HEAD)
    - export GIT_TAG_NAME=$(git describe --tags)
  script:
    - skaffold run --profile demo
    - skaffold run --profile preprod
    - skaffold run --profile prod | ./docker-tag-latest.awk
  only:
    - tags
  when: manual
  tags:
    - nlx-privileged
    - shell
