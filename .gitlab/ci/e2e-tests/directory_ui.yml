Directory UI - E2E Tests:
  stage: E2E tests
  image: registry.gitlab.com/commonground/core/puppeteer
  cache:
    key: ${CI_COMMIT_REF_SLUG}
    paths:
      - directory-ui-e2e-tests/node_modules/
  before_script:
    - export CI_ENV_URL=$([ -f ci_environment_url.txt ] && cat ci_environment_url.txt)
    - export URL=$([ -z "$CI_ENV_URL" ] && echo "https://directory.acc.nlx.io" || echo "https://directory-nlx-directory-$CI_ENV_URL")
  script:
    - ./wait-for-http.sh $URL
    - cd directory-ui-e2e-tests/
    - npm install --no-progress --color=false --quiet
    - npm test
  only:
    - /^feature/.*$/@commonground/nlx/nlx
    - master@commonground/nlx/nlx
