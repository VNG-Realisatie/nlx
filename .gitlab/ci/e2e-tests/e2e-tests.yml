Directory UI - E2E Tests:
  image: docker:stable
  stage: E2E tests
  variables:
    DOCKER_HOST: tcp://docker:2375/
    DOCKER_DRIVER: overlay2
  before_script:
    - export CI_ENV_URL=$([ -f ci_environment_url.txt ] && cat ci_environment_url.txt)
    - export DIRECTORY_UI_URL=$([ -z "$CI_ENV_URL" ] && echo "https://directory.acc.nlx.io" || echo "https://directory-nlx-directory-$CI_ENV_URL")
    - export E2E_IMAGE=${CI_REGISTRY_IMAGE}/directory-e2e-tests
  script:
    - |
      docker build --tag $E2E_IMAGE:$CI_COMMIT_SHORT_SHA directory-ui-e2e-tests && \
      docker run --rm --cap-add=SYS_ADMIN \
      -e URL=$DIRECTORY_UI_URL \
      $E2E_IMAGE:$CI_COMMIT_SHORT_SHA \
      /bin/sh -c './wait-for-http.sh $URL && npm test'
  tags:
    - docker
    - linux
  services:
    - docker:dind
  only:
    - master
    - /^feature\/.*$/
