syntax = "proto3";

// Package inspectionapi defines the directory api.
package inspectionapi;

import "google/api/annotations.proto";
import "github.com/gogo/protobuf/gogoproto/gogo.proto";

option (gogoproto.marshaler_all) = true;
option (gogoproto.sizer_all) = true;
option (gogoproto.unmarshaler_all) = true;
option (gogoproto.goproto_getters_all) = false;

// The Inspection service definition.
service InspectionService {
	// RegisterInway registers an inway for a given service
	rpc RegisterInway (RegisterInwayRequest) returns (RegisterInwayResponse) {}
	
	// ListServices lists all services and their gateways.
	rpc ListServices (ListServicesRequest) returns (ListServicesResponse) {
		option (google.api.http).get = "/directory/list-services";
	}
	// ListOrganizations lists all organizations and their details.
	rpc ListOrganizations (ListOrganizationsRequest) returns (ListOrganizationsResponse) {
		option (google.api.http).get = "/directory/list-organizations";
	}
	rpc GetServiceAPISpec (GetServiceAPISpecRequest) returns (GetServiceAPISpecResponse) {
		option (google.api.http).get = "/directory/get-service-api-spec/{organization_name}/{service_name}";
	}
}

message RegisterInwayRequest {
	message RegisterService {
		string name = 1;
		string documentation_url = 2;
		string api_specification_type = 3; // Deprecated. Type is deducted from api_specification_document_url
		string api_specification_document_url = 4;
		string insight_api_url = 5;
		string irma_api_url = 6;
		bool internal = 7;
	}

	string inway_address = 1;
	repeated RegisterService services = 2;
}

message RegisterInwayResponse {
	string error = 1;
}

message ListServicesRequest {}

message ListServicesResponse {
	message Service {
		string organization_name = 1;
		string service_name = 2;
		repeated string inway_addresses = 3;
		string documentation_url = 4;
		string api_specification_type = 5;
		bool internal = 6;
	}

	repeated Service services = 2;
}


message ListOrganizationsRequest {}

message ListOrganizationsResponse {
	message Organization {
		string name = 1;
		string insight_irma_endpoint = 2;
		string insight_log_endpoint = 3;
	}

	repeated Organization organizations = 2;
}


message GetServiceAPISpecRequest {
	string organization_name = 1;
	string service_name = 2;
}

message GetServiceAPISpecResponse {
	string type = 1;
	bytes document = 2;
}

